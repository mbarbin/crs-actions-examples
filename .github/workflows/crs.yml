name: CRs Workflows

on:
  pull_request:
    branches:
      - "**" # This will match pull requests targeting any branch

# =============================================================================
# CONFIGURATION
# Each demo branch enables the relevant workflows by setting these to "true".
# =============================================================================
env:
  INSTALL_REVIEWDOG: "false"
  RUN_ANNOTATE_CRS_IN_PR: "false"
  RUN_COMMENT_CRS_IN_PR: "false"
  RUN_CREATE_CRS_PR_CHECK: "false"
  RUN_CREATE_CRS_PR_JOB_SUMMARY: "true"
  RUN_SUMMARIZE_CRS_IN_PR: "false"
# =============================================================================

permissions:
  # Not all workflows demonstrated here require the same permissions. Some do
  # not need the write permissions. However, GHA do not support specifying
  # permissions settings at the granularity of the step, so you need to set the
  # permissions to the union of all permissions required by all steps. Make sure
  # in your workflows to set the permissions to the minimum strictly required by
  # the workflows you use. Here we add more permissions in each PR depending on
  # the requirements.
  contents: read
  pull-requests: read

jobs:
  crs-workflows:
    # The CRs Workflows only need to be run once so we choose ubuntu-latest.
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      # All CRs workflows require the 'crs' tool, so you are going to need this
      # no matter which workflow you use.
      #
      - name: Install crs
        uses: mbarbin/crs-actions/setup-crs@061f8bc6ac432c1ebc575489f0ea1bc499be0e78 # v1.0.0-alpha.10
        with:
          crs-version: 0.0.20251014
          crs-digest: sha256:82ac2264a2b6bd6e3dc47b1ff273eebc2682efe3ad255b14eab9b001b9c1eee6

      # If you choose a workflow that requires `reviewdog`, you'll need to set
      # it up too. The distribution includes an shared action for this:
      #
      - name: Install reviewdog
        if: env.INSTALL_REVIEWDOG == 'true'
        uses: reviewdog/action-setup@d8edfce3dd5e1ec6978745e801f9c50b5ef80252 # v1.4.0
        with:
          reviewdog_version: v0.20.3

      # Comment on CRs in PR
      # requires: crs, reviewdog, pull-requests: write
      #
      - name: Comment on CRs in PR
        if: env.RUN_COMMENT_CRS_IN_PR == 'true'
        uses: mbarbin/crs-actions/comment-crs-in-pr@061f8bc6ac432c1ebc575489f0ea1bc499be0e78 # v1.0.0-alpha.10
        with:
          crs-config: .github/crs-config.json

      # Annotate CRs in PR
      # requires: crs
      #
      - name: Annotate CRs in PR
        if: env.RUN_ANNOTATE_CRS_IN_PR == 'true'
        uses: mbarbin/crs-actions/annotate-crs-in-pr@061f8bc6ac432c1ebc575489f0ea1bc499be0e78 # v1.0.0-alpha.10
        with:
          crs-config: .github/crs-config.json

      # Create CRs PR Check
      # requires: crs, reviewdog
      #
      - name: Create CRs PR Check
        if: env.RUN_CREATE_CRS_PR_CHECK == 'true'
        uses: mbarbin/crs-actions/create-crs-pr-check@061f8bc6ac432c1ebc575489f0ea1bc499be0e78 # v1.0.0-alpha.10
        with:
          crs-config: .github/crs-config.json

      # Create CRs PR Job Summary
      # requires: crs
      #
      - name: Create CRs PR Job Summary
        if: env.RUN_CREATE_CRS_PR_JOB_SUMMARY == 'true'
        uses: mbarbin/crs-actions/create-crs-pr-job-summary@061f8bc6ac432c1ebc575489f0ea1bc499be0e78 # v1.0.0-alpha.10
        with:
          crs-config: .github/crs-config.json

      # Summarize CRs in PR
      # requires: crs, pull-requests: write
      #
      - name: Summarize CRs in PR
        if: env.RUN_SUMMARIZE_CRS_IN_PR == 'true'
        uses: mbarbin/crs-actions/summarize-crs-in-pr@061f8bc6ac432c1ebc575489f0ea1bc499be0e78 # v1.0.0-alpha.10
        with:
          crs-config: .github/crs-config.json
